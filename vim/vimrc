source ~/dotfiles/vim/plugs.vim

if filereadable("Session.vim")
  silent! source Session.vim
endif

inoremap jk <Esc>

let env_color_light=$ENV_COLOR_LIGHT
if (env_color_light == '1')
  set background=light
else
  set background=dark
endif

silent! colorscheme solarized


" Uncomment line below to autostrip trailing whitespace on buffer write
autocmd FileType c,cpp,java,make,perl,vim,markdown,text autocmd BufWritePre <buffer> :%s/\s\+$//e

" Automatically open quickfix window after any grep
autocmd QuickFixCmdPost *grep* cwindow

" Don't swamp buffer list with fugitive buffers
autocmd BufReadPost fugitive://* set bufhidden=delete

" Make sure always to cd to cwd for each file opened in quickfix
" to resolve filenames consistenly and to avoid (hopefully) any
" cd's to other dirs than cwd.
autocmd BufAdd * exe "cd" fnameescape(getcwd())

set hidden
set cursorline
set number
set nobackup
set noswapfile
set showtabline=1
set foldlevelstart=99

" Airline configuration
let g:airline_powerline_fonts = 1
let g:airline_skip_empty_sections = 1
let g:airline#extensions#obsession#enabled = 1
let g:airline_section_x = '%{PencilMode()}'
let g:airline_section_y = '%{fnamemodify(getcwd(), ":~:.")}'

let g:airline_symbols = get(g:,'airline_symbols',{})
let g:airline_symbols.maxlinenr=''

" Map leader
let mapleader = "\<Space>"

function! GetSearchPath()
  let l:output = system("git rev-parse --show-toplevel")
  if v:shell_error == 0
    let l:output = substitute(l:output, "\\n", "", "")
  else
    let l:output = expand("%:p:h")
  endif
  return l:output
endfunction

" nnoremap <leader>g :Ag! --ignore tags <C-R>=expand("<cword>")<CR> <C-R>=GetSearchPath()<CR>

" Use ag for ack
if executable('ag')
    let g:ackprg = 'ag --vimgrep'
endif

" Ag(Ack) mapping
nnoremap <Leader>a :Ack --cc --asm <C-R>=expand("<cword>")<CR><CR>
" nnoremap <leader>g :Ack <C-R>=expand("<cword>")<CR> <C-R>=GetSearchPath()<CR><CR>

" Ggrep mapping
nnoremap <leader>g :Ggrep <C-R>=expand("<cword>")<CR><CR><CR>

" FZF mappings
nnoremap <Leader>t :Tags<CR>
nnoremap <Leader>b :Buffers<CR>
nnoremap <Leader>f :Files<CR>

" Close quickfix window
nnoremap <Leader>c :ccl<CR>

" Load project specific vim configuration (vim must start from .vim.custom folder)
if filereadable(".vim.custom")
  so .vim.custom
endif


